<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>waterfall_js</title>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #flow {
            list-style: none;
            margin: 0 auto;
            position: relative;
        }

        #flow li {
            position: absolute;
            background-color: #CCCCCC;
            font-size: 50px;
            width: 200px;
            transition: all 1s;
        }
    </style>
</head>
<body>
    <ul id="flow"></ul>
</body>
<script>
    function ranH (min,max) {
        return parseInt(Math.random() * (max - min + 1)) + min;
    }

    var flow = document.getElementById("flow");
    var leftSpace = 10;
    var paddingSpace = 10;
    var hs = [];

    function layout (bol) {

        var lis = document.getElementsByTagName("li");
        var cols = parseInt(document.documentElement.clientWidth / 200);

        flow.style.width = cols * 200 + 10 * (cols - 1) + 20;

        var arrH = [];
        for (var i = 0; i < cols; i++) {
            arrH[i] = 10;
        }

        function createLi (index) {

            var li = lis[index] || document.createElement("li");
            li.innerHTML = index;

            var h = hs[index] || ranH(100,300);
            li.style.height = h + "px";
            if (bol) {
                hs.push(h);
            }

            var minH = arrH[0];
            var minI = 0;
            for (var i = 0; i < cols; i++) {
                if (minH > arrH[i]) {
                    minH = arrH[i];
                    minI = i;
                }
            }

            var  l = leftSpace + (200 + paddingSpace) * minI;
            li.style.left = l + "px";

            li.style.top = arrH[minI] + "px";

            bol && flow.appendChild(li);

            arrH[minI] = arrH[minI] + li.offsetHeight + paddingSpace;
        }
        for (var i = 0; i < 30; i++) {
            createLi(i);
        }
    }

    layout(true);
    window.onresize = function  () {
        layout(false);
    }
</script>
</html>